  <!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		
		
		<meta name="generator" content="Hugo 0.50" />
		<title>Backup Solutions under Arch &middot; Bruce Y. Li&#39;s Site</title>
		<link rel="stylesheet" href="https://bruceyli.com/css/bulma.css">
		<link rel="stylesheet" href="https://bruceyli.com/css/style.css">
		<link rel="stylesheet" href="https://bruceyli.com/css/highlight.css">
    <link rel="icon" href="https://bruceyli.com/images/favicon.ico" />
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">


  <body>
  
  <nav class="navbar" style = "padding: 0rem 4rem; margin-bottom: 0;">
  <div class="navbar-brand">
    <div class="navbar-item">
      <a class="button is-dark is-outlined" href="https://bruceyli.com">
        Bruce Y Li's Website
      </a>
    </div>

  </div>

  <div class="navbar-menu" style="border-bottom: 1px solid #f2f2f2">
    <div class="navbar-end">
      <a class="navbar-item" href="https://bruceyli.com/research">
        Research
      </a>
      <a class="navbar-item" href="https://bruceyli.com/code">
        Code
      </a>
      <a class="navbar-item" href="https://bruceyli.com/data">
        Data
      </a>
      <a class="navbar-item" href="https://bruceyli.com/blog">
        Blog
      </a>
      <a class="navbar-item" href="https://bruceyli.com/about">
        About
      </a>
    </div>
  </div>
</nav>


  <section class="section is-fluid"> <div class="columns">
      <div class="column is-8 is-offset-2">
  
        <div class="content">
          <h2 class="title is-3 is-spaced posttitle">
            Backup Solutions under Arch 
          </h2>
          <h6 class="subtitle is-6" style="font-style: italic; font-size:90%;">
             Publish Date: Oct 6, 2015 &nbsp;&nbsp;
             Last Update: Jun 28, 2018
          </h6>
  
          
            
              <div class="columns">
                <div class="column is-3 is-hidden-touch">
                  <aside class="menu">
                    <p class="menu-label">
                      Table of Contents
                    </p>
                    <p class="menu-list">
                      <nav id="TableOfContents">
<ul>
<li><a href="#what-is-this-post-for">What is this post for?</a></li>
<li><a href="#steps-for-backing-up">Steps for backing up</a></li>
<li><a href="#steps-for-recovering">Steps for Recovering</a></li>
</ul>
</nav>
                    </p>
                  </aside>
                </div>
                <div class="column">
                  

<h1 id="what-is-this-post-for">What is this post for?</h1>

<p>Recently I have spilled coffee over my Thinkpad several times, and that makes
me realize the importance of backing up my system. This post serves as a guide
to back up the <strong>complete</strong> Linux system using <code>tar</code>.</p>

<h1 id="steps-for-backing-up">Steps for backing up</h1>

<ol>
<li><p>Boot from a live CD. Personally I keep an arch-linux live CD in a flash
drive.</p></li>

<li><p>Mount the drives on the computer.</p></li>
</ol>

<pre><code class="language-bash">sudo mkdir /mnt/arch/
sudo mount /dev/sda2 /mnt/arch
sudo mount /dev/sda1 /mnt/arch/boot
</code></pre>

<ol>
<li><p>Chroot into the system. In Arch, use <code>arch-chroot</code>.</p></li>

<li><p>Using tar to backup the system</p></li>
</ol>

<pre><code class="language-bash">sudo tar --exclude-from=/path/to/exclusion-list \
         --xattrs -czpvf \
         /opt/backup/arch.tar.gz /
</code></pre>

<p>The <code>exclusion-list</code> is a text file containing the folders and the files that
we want to exclude to keep the backup file compact.
My <code>exclusion-list</code> looks like</p>

<pre><code class="language-txt">/dev/*
/proc/*
/sys/*
/tmp/*
/run/*
/mnt/*
/media/*
/lost+found
/var/lock/*
/var/run/*
/var/log/*
/var/lib/docker/*
/var/cache/pacman/pkg/*
/opt/backup/arch*
/home/user/*
</code></pre>

<p>The backup process can take quite long, depending on the size of the system.
After the job completion, the <code>arch.tar.gz</code> file should contains all the
necessary files now with attributions preserved.</p>

<h1 id="steps-for-recovering">Steps for Recovering</h1>

<p>Recovering is a bit more tricky. General steps are:</p>

<ol>
<li><p>Boot from a Live CD</p></li>

<li><p>Partition the drive. I use <strong>UEFI</strong> to boot my system, therefore the
appropriate way to partition the drive is to (1) create a 512M drive,
formatted as FAT32, and labeled as boot. (2) create the rest of the drive as
ext4.</p></li>

<li><p>Mount the drives. Similar to the steps above.</p></li>

<li><p>Chroot into the system</p></li>

<li><p>Extract the <code>arch.tar.gz</code> file to the system.</p></li>
</ol>

<pre><code class="language-bash">tar --verbose --xattrs -xpf /media/XX/arch.tar.gz 
</code></pre>

<ol>
<li>Change <code>fstab</code> and <code>/boot</code>. I use <code>GPARTED</code> to get the UUID of the
partitions and modify the <code>fstab</code> accordingly. Further one can make sure the
<code>boot</code> folder is correctly specified. All these are done with chroot.</li>
</ol>

<pre><code class="language-bash">cd /mnt/arch/
chroot . /bin/bash
</code></pre>

<p>Reboot the system, and everything is back as if never being moved!</p>

                </div>
              </div>
            
          
        </div>

      </div>
    </div>
  </section>
     
  <footer class="footer" style="background-color:transparent;">
  <div class="container">
    <div class="columns">
      <div class="column is-offset-4 is-4" style="border-bottom: 1px solid #f2f2f2; ">
        <nav class="level">
          <div class="level-item has-text-centered">
            <a href="mailto:yuan@bruceyli.com" style="color: grey; font-size: 0.9rem;">
              <i class="fas fa-envelope fa-lg" aria-hidden="true"></i>
            </a>
          </div>
          
          <div class="level-item has-text-centered">
            <a href="https://github.com/lipop/" style="color: grey; font-size: 0.9rem;">
              <i class="fab fa-github fa-lg" aria-hidden="true"></i>
            </a>
          </div>
          <div class="level-item has-text-centered">
            <a href="https://www.linkedin.com/in/yuan-li-b0339759/" style="color: grey; font-size: 0.9rem;">
              <i class="fab fa-linkedin-in fa-lg" aria-hidden="true"></i>
            </a>
          </div>
          <div class="level-item has-text-centered">
            <a href="https://zhuanlan.zhihu.com/de-bug" style="color: grey; font-size: 0.9rem;">
              <i class="fab fa-zhihu fa-lg" aria-hidden="true"></i>
            </a>
          </div>
        </nav>
      </div>
    </div>
    <div class="columns">
      <div class="column has-text-centered">
        <p class="copyright" style="font-size:0.9rem; color: grey;">
          Â© Copyright 2010-2018 <i class="fas fa-arrow-circle-right" aria-hidden="true"></i> 
          Handcrafted by Bruce Y. Li
        </p>
      </div>
    </div>
  </div>
</footer>


  <script type="text/javascript" src="https://bruceyli.com/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-57655202-2', 'auto');
	
	ga('send', 'pageview');
}
</script>




  

  </body>
</html>
